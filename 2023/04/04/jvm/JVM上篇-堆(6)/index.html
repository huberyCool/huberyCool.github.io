
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>JVM上篇：堆(6) | 小鸡吃米</title>
        <meta name="author" content="HuberyCool" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/images/hexo/baby2.png" />

<!--        爱心点击样式-->
<!--        <script type="text/javascript" src="/js/click-love.js"></script>-->

<!--        鼠标点击爆炸烟花和特效-->
        <canvas id="fireworks" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"></canvas>
        <script type="text/javascript" src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>
        <script type="text/javascript" src="/js/fireworks.js"></script>
        <canvas id="background" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"></canvas>
        <script type="text/javascript" src="/js/background.js"></script>
        <div id="cursor"></div>
        <link rel="stylesheet" href="/css/cursor.min.css">
        <script type="text/javascript" src="/js/cursor.min.js"></script>

        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>小鸡吃米</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;小鸡吃米</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>JVM上篇：堆(6)</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/4/4
        </span>
        
        <span class="category">
            <a href="/categories/%E7%AC%94%E8%AE%B0/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                笔记
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/tags/jvm/" style="color: #00a596">jvm</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/java/" style="color: #00bcd4">java</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p>接上一篇 <a href="/2023/04/04/JVM%E4%B8%8A%E7%AF%87-%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88(5)/">JVM上篇-本地方法接口和本地方法栈(5)</a></p>
<span id="more"></span>

<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><h3 id="1-核心概述"><a href="#1-核心概述" class="headerlink" title="1. 核心概述"></a>1. 核心概述</h3><p>堆针对一个JVM进程来说是唯一的，但是进程包含多个线程，所以堆不是线程私有的，是共享的</p>
<p>堆也是java内存管理的核心区域</p>
<p>堆区在JVM启动的时候即被创建，其空间大小也就被确定了。(堆内存的大小是可以调节的)</p>
<p>堆是JVM管理的最大一块内存空间</p>
<p>《java虚拟机规范》规定，堆可以处于物理上不联系的内存空间，但是逻辑上它应该被视为连续的</p>
<p>堆上还可以划分线程私有的缓冲区(Thread Local Allocation Buffer - TLAB)</p>
<p>《java虚拟机规范》中对堆的描述</p>
<blockquote>
<p>所有的对象实例以及数组都应该在运行时分配在堆上</p>
</blockquote>
<p>一个方法开始执行，创建栈帧，方法中的数组和对象会在堆中创建，栈帧中保存的是其指向堆中对应位置的引用，方法结束后，堆中的对象不会马上被移除，而是等待垃圾收集器来回收</p>
<p>堆，是GC(Garbage Collection) 执行垃圾回收的重点区域</p>
<h4 id="1-1-堆内存细分"><a href="#1-1-堆内存细分" class="headerlink" title="1.1 堆内存细分"></a>1.1 堆内存细分</h4><p>Java7及之前</p>
<ul>
<li>新生代(Young Generation Space)<ul>
<li>Eden区</li>
<li>Survivor区<ul>
<li>S0区</li>
<li>S1区</li>
</ul>
</li>
</ul>
</li>
<li>老年代(Tenure Generation Space)</li>
<li>永久代(Permanent Space)</li>
</ul>
<p>Java8及之后</p>
<ul>
<li>新生代(Young Generation Space)<ul>
<li>Eden区</li>
<li>Survivor区<ul>
<li>S0区</li>
<li>S1区</li>
</ul>
</li>
</ul>
</li>
<li>老年代(Tenure Generation Space)</li>
<li>元空间(Meta Space)</li>
</ul>
<blockquote>
<p>默认情况下空间占比 Eden:S0:S1 &#x3D; 8:1:1<br>新生代:老年代 &#x3D; 1:2</p>
</blockquote>
<h4 id="1-2-堆内存设置"><a href="#1-2-堆内存设置" class="headerlink" title="1.2 堆内存设置"></a>1.2 堆内存设置</h4><p>java堆区用于存储java对象实例，那么堆的大小在JVM启动时就已经设定好了，可以通过一下选项来设置其内存大小</p>
<ul>
<li>-Xms(-XX:InitialHeapSize) 用于表示堆区的起始内存</li>
<li>-Xmx(-XX:MaxHeapSize) 用于表示堆区的最大内存</li>
</ul>
<p>一旦堆区中的内存大小超过-Xmx所设定的最大内存时，将会抛出OOM(OutOfMemoryError)异常</p>
<p>通常会将-Xms和-Xmx两个参数设置相同的值，其目的是为了能够在java垃圾回收机制清理完堆区后不需要重新分割计算堆区的大小，从而提高性能</p>
<p>默认情况下</p>
<ul>
<li>初始内存大小： 物理机电脑内存大小 &#x2F; 64</li>
<li>最大内存大小： 物理机电脑内存大小 &#x2F; 4</li>
</ul>
<h4 id="1-3-年轻代和老年代"><a href="#1-3-年轻代和老年代" class="headerlink" title="1.3 年轻代和老年代"></a>1.3 年轻代和老年代</h4><p>存储在JVM中的对象可以划分为两类</p>
<ul>
<li>生命周期较短的瞬时对象，这类对象的创建和消亡都非常迅速</li>
<li>生命周期非常长的，在某些极端情况下还能够与JVM的生命周期保持一致</li>
</ul>
<p>配置新生代和老年代在堆中的内存占比，可以通过设置-XX:NewRation来进行配置<br>默认情况下-XX:NewRation&#x3D;2，表示新生代:老年代&#x3D;1:2<br>如果设置成4，则标识新生代:老年代&#x3D;1:4</p>
<p>当然也可以通过配置调整新生代中的Eden:S0:S1的内存占比，可以通过-XX:survivorRatio来配置，默认情况下-XX:survivorRatio&#x3D;8，也就是Eden:S0:S1&#x3D;8:1:1</p>

    </div>
    
    
    
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2023 - 2023 小鸡吃米
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;HuberyCool
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        




        
    </body>
</html>
